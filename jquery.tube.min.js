/*! jquery.tube.js 0.0.1 | https://github.com/inukshuk/jquery.tube.js */
(function(a,b,c,d,e){"use strict";var f=function(b){this.statistics={},this.thumbnails=[],b&&a.extend(this,b)};f.constants={users:"//www.youtube.com/user/{name}"},f.templates={thumbnail:'<img src="{url}" width="{width}" height="{height}" title="{title}" />',title:"<h1>{title} ({duration})</h1>",author:'<a href="{url}">{name}</a>',description:"<p>{description}</p>",statistics:'<span class="statistics">{views} / {favorites}</span>',video:"{title}{thumbnail}{description}<p>{author} â€“ {statistics}</p></div>"};var g=function(a){return("0"+a).slice(-2)};f.prototype.parse=function(b){try{b.id&&(this.id=b.id.$t.match(/\/([^\/]*)$/)[1]),b.author&&a.isArray(b.author)&&(this.author={name:b.author[0].name.$t,id:b.author[0].uri.$t.match(/\/([^\/]*)$/)[1]},this.author.url=f.constants.users.supplant(this.author)),b.yt$statistics&&(this.statistics.favorites=b.yt$statistics.favoriteCount,this.statistics.views=b.yt$statistics.viewCount),b.title&&(this.title=b.title.$t);if(b.media$group){var c=b.media$group;c.media$description&&(this.description=c.media$description.$t),c.yt$duration&&(this.duration_in_seconds=parseInt(c.yt$duration.seconds,10)),c.media$thumbnail&&a.isArray(c.media$thumbnail)&&(this.thumbnails=a.map(c.media$thumbnail,function(a){return a}))}}catch(d){console.log(d)}return this},f.prototype.seconds=function(){return(this.duration_in_seconds||0)%60},f.prototype.minutes=function(){return parseInt((this.duration_in_seconds||0)/60,10)%60},f.prototype.hours=function(){return parseInt((this.duration_in_seconds||0)/3600,10)},f.prototype.duration=function(){if(!this.duration_in_seconds)return"";var a=this.hours(),b=this.minutes(),c=this.seconds();return(a?[a,g(b),g(c)]:[b,g(c)]).join(":")},f.prototype.html=function(){return f.templates.video.supplant({title:f.templates.title.supplant({title:this.title,duration:this.duration()}),thumbnail:f.templates.thumbnail.supplant(this.thumbnails[0]),description:f.templates.description.supplant(this),author:f.templates.author.supplant(this.author),statistics:f.templates.statistics.supplant(this.statistics)})};var h=function(b){this.videos=[],this.options=a.extend({},h.defaults,b)};h.constants={api:"//gdata.youtube.com/feeds/api/"},h.defaults={player:"#player",order:"relevance",author:!1,version:2,format:5,limit:10,key:!1},h.parameters={q:"query","max-results":"limit",key:"key",format:"format",orderby:"order",author:"author",version:"v"},h.serialize=function(b){var c;switch(typeof b){case"string":c=encodeURI(b);break;case"object":b===null?c="":c=a.map(b,function(a,b){if(a)return[encodeURI(b),encodeURI(a)].join("=")}).join("&");break;default:c=""}return c},h.prototype.load=function(b){var c=this,d=0;return a.getJSON(this.request(),function(e){d=e.feed.entry.length,c.videos=a.map(e.feed.entry,function(a){return(new f).parse(a)}),b&&a.isFunction(b)&&b.apply(c,[d])}),this},h.prototype.parameters=function(){var b=this,c={};return a.each(h.parameters,function(a,d){b.options[d]&&(c[a]=b.options[d])}),c.alt="json-in-script",c.callback="?",c},h.prototype.request=function(b){var c=h.constants.api;return a.extend(this.options,b||{}),this.options.playlist?c+="playlists/"+this.options.playlist:c+="videos",[c,"?",h.serialize(this.parameters())].join("")},h.prototype.authenticate=function(){return this},h.prototype.html=function(){var b=a.map(this.videos,function(a){return"<li>"+a.html()+"</li>"});return"<ol>"+b.join("")+"</ol>"};var i=function(a){this.options=a};i.ready=!1,i.load=function(b){if(!i.ready){i.callback=b;var d=c.createElement("script");return d.src=a.tube.constants.api,a("script:first").before(d),!0}return!1},String.prototype.supplant||(String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return typeof d=="string"||typeof d=="number"?d:b})});var j={load:i.load,ready:i.ready};a.fn.tube=function(a){var b,c;if(this.length){typeof a=="string"?c={query:a}:c=a;var d=this.first();d.data("tube",(new h(c)).load(function(a){d.html(this.html())}))}return this},a.tube=function(b){var c=j[b];return a.isFunction(c)?c.call():c},a.tube.constants=h.constants,a.tube.defaults=h.defaults,b.onYouTubePlayerAPIReady=function(){i.ready=!0,console.log("player API loaded")}})(jQuery,window,window.document,"0.0.1")

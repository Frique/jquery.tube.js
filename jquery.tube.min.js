/*! jquery.tube.js 0.0.1 | https://github.com/inukshuk/jquery.tube.js */
(function(a,b,c,d,e){"use strict",String.prototype.supplant||(String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return typeof d=="string"||typeof d=="number"?d:b})}),Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=a<0?this.length+a:a,this.push.apply(this,c)};var f=function(b){return b=b||{},this.on=function(c,d){return b[c]=b[c]||[],a.isFunction(d)&&b[c].push(d),this},this.off=function(a,c){if(b[a]){var d,e=b[a],f=[];if(c){for(d=0;d<e.length;++d)e[d]===c&&f.push(d);for(d=0;d<f;++d)e.remove(d)}else b[a]=[]}return this},this.notify=function(c){var d=this;return b[c]&&a.each(b[c],function(){a.isFunction(this)&&this.apply(d,[c])}),this},this},g=function(b){this.statistics={},this.thumbnails=[],b&&a.extend(this,b)};g.constants={users:"//www.youtube.com/user/{name}"},g.templates={thumbnail:'<img src="{url}" title="{title}" />',title:"<h1>{title} ({duration})</h1>",author:'<a href="{author_url}">{author}</a>',description:"<p>{description}</p>",statistics:'<span class="statistics">{views} / {favorites}</span>',video:'<a href="#{id}" rel="{index}">{title}{thumbnail}{description}<p>{author} â€“ {statistics}</p></a>'};var h=function(a){return("0"+a).slice(-2)};g.prototype.parse=function(b){try{b.id&&(this.id=b.id.$t.match(/\/([^\/]*)$/)[1]),b.author&&a.isArray(b.author)&&(this.author={name:b.author[0].name.$t,id:b.author[0].uri.$t.match(/\/([^\/]*)$/)[1]},this.author.url=g.constants.users.supplant(this.author)),b.yt$statistics&&(this.statistics.favorites=b.yt$statistics.favoriteCount,this.statistics.views=b.yt$statistics.viewCount),b.title&&(this.title=b.title.$t);if(b.media$group){var c=b.media$group;c.media$description&&(this.description=c.media$description.$t),c.yt$duration&&(this.duration_in_seconds=parseInt(c.yt$duration.seconds,10)),c.media$thumbnail&&a.isArray(c.media$thumbnail)&&(this.thumbnails=a.map(c.media$thumbnail,function(a){return a}))}}catch(d){console.log(d)}return this},g.prototype.seconds=function(){return(this.duration_in_seconds||0)%60},g.prototype.minutes=function(){return parseInt((this.duration_in_seconds||0)/60,10)%60},g.prototype.hours=function(){return parseInt((this.duration_in_seconds||0)/3600,10)},g.prototype.duration=function(){if(!this.duration_in_seconds)return"";var a=this.hours(),b=this.minutes(),c=this.seconds();return(a?[a,h(b),h(c)]:[b,h(c)]).join(":")},g.prototype.properties=function(a){var b=this.thumbnails[1]||this.thumbnails[0];return{id:this.id,index:a,title:this.title,duration:this.duration(),description:this.description,author:this.author.name,author_url:this.author.url,views:this.statistics.views,favorites:this.statistics.favorites,url:b.url}},g.prototype.render=function(a,b){var c=this.properties(b);return a=a||g.templates,a.video.supplant({id:this.id,index:b,title:g.templates.title.supplant(c),thumbnail:g.templates.thumbnail.supplant(c),description:g.templates.description.supplant(c),author:g.templates.author.supplant(c),statistics:g.templates.statistics.supplant(c)})};var i=function(b){var c=this;this.videos=[],this.options=a.extend({},i.defaults,b),this.current=0,this.player=new j({id:this.options.player}),this.options.templates=a.extend(g.templates,this.options.templates||{}),a.each(i.events,function(a,b){c.options[b]&&c.on(b,c.options[b])})};f.apply(i.prototype),i.constants={api:"//gdata.youtube.com/feeds/api/"},i.defaults={player:"player",autoload:!1,autoplay:!1,start:0,order:"relevance",author:!1,version:2,format:5,limit:10,key:!1},i.parameters={q:"query","max-results":"limit",key:"key",format:"format",orderby:"order",author:"author",version:"v"},i.events=["load","ready","play","pause"],i.serialize=function(b){var c;switch(typeof b){case"string":c=encodeURI(b);break;case"object":b===null?c="":c=a.map(b,function(a,b){if(a)return[encodeURI(b),encodeURI(a)].join("=")}).join("&");break;default:c=""}return c},i.prototype.load=function(b){var c=this,d=0;return a.getJSON(this.request(),function(e){d=e.feed.entry.length,c.videos=a.map(e.feed.entry,function(a){return(new g).parse(a)}),d&&(c.options.autoload||c.options.autoplay)&&(c.current=Math.min(c.videos.length-1,Math.max(0,c.options.start-1)),c.player[c.options.autoplay?"play":"load"](c.videos[c.current])),c.notify("load"),b&&a.isFunction(b)&&b.apply(c,[d]),c.notify("ready")}),this},i.prototype.parameters=function(){var b=this,c={};return a.each(i.parameters,function(a,d){b.options[d]&&(c[a]=b.options[d])}),c.alt="json-in-script",c.callback="?",c},i.prototype.request=function(b){var c=i.constants.api;return a.extend(this.options,b||{}),this.options.playlist?c+="playlists/"+this.options.playlist:c+="videos",[c,"?",i.serialize(this.parameters())].join("")},i.prototype.authenticate=function(){return this},i.prototype.play=function(b){if(a.isNumeric(b)){var c=b%this.videos.length;this.current=c<0?this.videos.length-c:c,this.player&&this.videos.length&&this.player.play(this.videos[this.current])}else this.player.resume();return this},i.prototype.pause=function(a){return this.player&&this.player.pause(),this},i.prototype.stop=function(a){return this.player&&this.player.stop(),this},i.prototype.next=function(){return this.advance(1)},i.prototype.previous=function(){return this.advance(-1)},i.prototype.advance=function(a){return this.play(this.current+(a||1))},i.prototype.render=function(){var b=this.options.templates,c=a.map(this.videos,function(a,c){return"<li>"+a.render(b,c)+"</li>"});return"<ol>"+c.join("")+"</ol>"};var j=function(a){this.options=a,this.p=null};f.apply(j.prototype),j.constants={swfobject:"//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"},j.defaults={id:"player",quality:"medium",width:640,height:360,autohide:2,autoplay:0,controls:1,loop:0,theme:"dark"},j.prototype.play=function(a){return this.p?(a?this.p.loadVideoById(a.id,0,this.options.quality):this.p.playVideo(),this):this.load(a)},j.prototype.resume=function(){return this.p&&this.p.playVideo(),this},j.prototype.pause=function(){return this.p&&this.p.pauseVideo(),this},j.prototype.stop=function(){return this.p&&this.p.stopVideo(),this},j.prototype.clear=function(){return this.p&&(this.p.stopVideo(),this.p.clearVideo()),this},j.prototype.event_proxy_for=function(b){return a.proxy(this.notify,this,b)},a.isFunction(b.postMessage)?(j.api="iframe",j.constants.api="//www.youtube.com/player_api",j.constants.events={onReady:"ready",onStateChange:"state",onPlaybackQualityChange:"quality",onError:"error"},j.load=function(d){if(typeof YT=="undefined"){var e=c.createElement("script");return b.onYouTubePlayerAPIReady=function(){a.isFunction(d)&&d.call()},e.src=j.constants.api,a("script:first").before(e),!1}return a.isFunction(d)&&setTimeout(d,0),!0},j.prototype.load=function(b){var c=this,d=a.extend({},this.options,{videoId:b.id});return j.load(function(){try{a.each(j.constants.events,function(a,b){d[a]=c.event_proxy_for(b)}),c.p=new YT.Player(d.id,d)}catch(b){console.log("Failed to load YouTube player: ",b)}}),this}):(j.api="js",j.constants.api="//www.youtube.com/v/{video}?enablejsapi=1&playerapiid=ytplayer&version=3",j.load=function(b){if(!swfobject){var d=c.createElement("script");return a(d).load(function(){a.isFunction(b)&&b.call()}),d.src=j.constants.swfobject,a("script:first").before(d),!1}return a.isFunction(b)&&setTimeout(b,0),!0},j.prototype.load=function(a){return this});var k={load:j.load};a.fn.tube=function(b){var c,d;return this.length&&(typeof b=="string"?d={query:b}:d=b,c=this.first(),c.data("tube",(new i(d)).load(function(b){var d=this,e=a(d.render());a("a[rel]",e).click(function(b){b.preventDefault(),d.play(a(this).attr("rel"))}),c.append(e)}))),this},a.tube=function(b){var c=k[b];return a.isFunction(c)?c.call():c},a.tube.constants=i.constants,a.tube.defaults=i.defaults})(jQuery,window,window.document,"0.0.1")
